<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miraculous Cloud Tracker</title>
    <style>
        body { background: #0f1014; color: #fff; font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        select { background: #222; color: #fff; padding: 10px; border: 1px solid #444; width: 100%; margin-bottom: 20px; font-size: 1rem; }
        .last-update { font-size: 0.8rem; color: #666; text-align: right; margin-bottom: 10px; }
        .card { background: #1a1d29; border: 1px solid #333; margin-bottom: 10px; padding: 15px; border-radius: 8px; }
        .ep-title { font-weight: bold; }
        .ep-date { color: #00d2d3; font-size: 0.85rem; }
        .lang-tag { font-size: 0.7rem; background: #333; padding: 2px 5px; border-radius: 4px; color: #aaa; }
        h2 { border-bottom: 2px solid #e11d48; padding-bottom: 5px; }
    </style>
</head>
<body>
    <h1>üêû Miraculous Tracker (Cloud)</h1>
    <div id="lastUpdate" class="last-update">Cargando datos...</div>
    
    <select id="countrySelect" onchange="renderPais()">
        <option value="">Cargando base de datos...</option>
    </select>

    <div id="content"></div>

    <script>
        let GLOBAL_DATA = null;

        // 1. CARGAR LA BASE DE DATOS JSON (Generada por el Robot)
        async function loadDatabase() {
            try {
                // Truco: Agregamos ?t=Date.now() para evitar cach√© del navegador
                const resp = await fetch('database.json?t=' + Date.now());
                if(!resp.ok) throw new Error("A√∫n no se ha generado la base de datos.");
                GLOBAL_DATA = await resp.json();
                
                document.getElementById('lastUpdate').innerText = "√öltima actualizaci√≥n: " + GLOBAL_DATA.last_updated;
                initMenu();
            } catch(e) {
                document.getElementById('content').innerHTML = `<div style="text-align:center; color:orange">
                    ü§ñ El robot est√° trabajando...<br>
                    La base de datos se est√° creando por primera vez.<br>
                    Vuelve en 5 minutos.
                </div>`;
            }
        }

        function initMenu() {
            const sel = document.getElementById('countrySelect');
            sel.innerHTML = '<option value="">-- Selecciona Pa√≠s --</option>';
            
            const regions = Object.keys(GLOBAL_DATA.regions).sort();
            regions.forEach(r => {
                const opt = document.createElement('option');
                opt.value = r;
                opt.text = r; // Aqu√≠ podr√≠as mapear AR -> Argentina si quieres
                sel.appendChild(opt);
            });
        }

        function renderPais() {
            const code = document.getElementById('countrySelect').value;
            const div = document.getElementById('content');
            if(!code || !GLOBAL_DATA) return;

            const data = GLOBAL_DATA.regions[code];
            if(!data) { div.innerHTML = "Sin datos."; return; }

            let html = '';

            // Novedades
            if(data.news.length > 0) {
                html += `<h2>üî• Novedades (√öltimos 90 d√≠as)</h2>`;
                data.news.forEach(ep => html += makeCard(ep));
            }

            // Temporadas
            data.seasons.forEach(s => {
                html += `<h3>Temporada ${s.num}</h3>`;
                s.eps.forEach(ep => html += makeCard(ep));
            });

            div.innerHTML = html;
        }

        function makeCard(ep) {
            return `
                <div class="card">
                    <div style="display:flex; justify-content:space-between">
                        <span class="ep-title">${ep.n}. ${ep.t}</span>
                        <span class="ep-date">${ep.d.split('T')[0]}</span>
                    </div>
                    <div style="margin-top:5px">
                        üîä ${ep.a.join(', ')}
                    </div>
                </div>
            `;
        }

        loadDatabase();
    </script>
</body>
</html>
